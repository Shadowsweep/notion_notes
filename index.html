<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticky Notes Wall for Notion</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;500;600;700&family=Comic+Neue:wght@300;400;700&family=Kalam:wght@300;400;700&family=Patrick+Hand&family=Architects+Daughter&family=Indie+Flower&family=Dancing+Script:wght@400;500;600;700&family=Permanent+Marker&family=Amatic+SC:wght@400;700&family=Shadows+Into+Light&display=swap" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Neue', cursive;
            height: 100vh;
            overflow: hidden;
            background: 
                radial-gradient(circle at 20% 20%, rgba(139, 69, 19, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 80% 80%, rgba(160, 82, 45, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 40% 60%, rgba(139, 69, 19, 0.05) 0%, transparent 25%),
                var(--bg-gradient, linear-gradient(135deg, #f5f1e8 0%, #e8dcc0 50%, #d4c4a0 100%));
            background-size: 300px 300px, 400px 400px, 250px 250px, 100% 100%;
            position: relative;
            transition: background 0.5s ease;
        }

        /* Cork board texture overlay */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(139, 69, 19, 0.1) 1px, transparent 1px),
                radial-gradient(circle at 75% 75%, rgba(160, 82, 45, 0.08) 1px, transparent 1px);
            background-size: 50px 50px, 80px 80px;
            pointer-events: none;
            opacity: 0.6;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(76, 175, 80, 0.4);
        }

        .clear-btn {
            background: linear-gradient(135deg, #f44336, #d32f2f);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .clear-btn:hover {
            box-shadow: 0 6px 16px rgba(244, 67, 54, 0.4);
        }

        .bg-btn {
            background: linear-gradient(135deg, #9C27B0, #7B1FA2);
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
        }

        .bg-btn:hover {
            box-shadow: 0 6px 16px rgba(156, 39, 176, 0.4);
        }

        .font-btn {
            background: linear-gradient(135deg, #FF5722, #D84315);
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.3);
        }

        .font-btn:hover {
            box-shadow: 0 6px 16px rgba(255, 87, 34, 0.4);
        }

        .save-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .save-btn:hover {
            box-shadow: 0 6px 16px rgba(33, 150, 243, 0.4);
        }

        .load-btn {
            background: linear-gradient(135deg, #607D8B, #455A64);
            box-shadow: 0 4px 12px rgba(96, 125, 139, 0.3);
        }

        .load-btn:hover {
            box-shadow: 0 6px 16px rgba(96, 125, 139, 0.4);
        }

        .screenshot-btn {
            background: linear-gradient(135deg, #FF9800, #F57C00);
            box-shadow: 0 4px 12px rgba(255, 152, 0, 0.3);
        }

        .screenshot-btn:hover {
            box-shadow: 0 6px 16px rgba(255, 152, 0, 0.4);
        }

        .bg-settings, .font-settings {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            display: none;
            min-width: 280px;
        }

        .font-settings {
            left: 320px;
        }

        .bg-settings.show, .font-settings.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bg-settings h3, .font-settings h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .bg-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .bg-option {
            width: 60px;
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .bg-option:hover {
            transform: scale(1.1);
            border-color: #4CAF50;
        }

        .bg-option.active {
            border-color: #2196F3;
            box-shadow: 0 0 10px rgba(33, 150, 243, 0.3);
        }

        .bg-option::after {
            content: '✓';
            position: absolute;
            top: 2px;
            right: 2px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            background: #4CAF50;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .bg-option.active::after {
            display: flex;
        }

        .font-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .font-control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .font-control-group label {
            font-size: 14px;
            font-weight: bold;
            color: #555;
        }

        .font-family-select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        .font-size-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .font-size-slider {
            flex: 1;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        .font-size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #4CAF50;
            cursor: pointer;
            border-radius: 50%;
        }

        .font-size-display {
            min-width: 40px;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }

        .custom-color-section {
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: 15px;
        }

        .custom-color-section h4 {
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-picker {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .apply-custom-btn, .apply-font-btn {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
        }

        .close-settings {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #f44336;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }

        .sticky-note {
            position: absolute;
            width: 200px;
            min-height: 200px;
            padding: 15px;
            border-radius: 3px;
            cursor: move;
            box-shadow: 
                0 4px 8px rgba(0, 0, 0, 0.15),
                0 1px 3px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease, transform 0.1s ease;
            transform-origin: center center;
            font-size: var(--note-font-size, 14px);
            line-height: 1.4;
            font-family: var(--note-font-family, 'Comic Neue');
        }

        .sticky-note:hover {
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.2),
                0 4px 8px rgba(0, 0, 0, 0.15);
            z-index: 100 !important;
        }

        .sticky-note.dragging {
            box-shadow: 
                0 12px 24px rgba(0, 0, 0, 0.25),
                0 8px 16px rgba(0, 0, 0, 0.15);
            transform: scale(1.05) !important;
            z-index: 1000 !important;
            cursor: grabbing;
        }

        .sticky-note textarea {
            width: 100%;
            height: 100%;
            min-height: 170px;
            border: none;
            background: transparent;
            resize: none;
            outline: none;
            font-size: inherit;
            font-family: inherit;
            line-height: inherit;
            color: #333;
            padding: 0;
        }

        .delete-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ff4444;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .sticky-note:hover .delete-btn {
            display: flex;
        }

        .delete-btn:hover {
            background: #cc0000;
            transform: scale(1.1);
        }

        /* Different note colors */
        .note-yellow { background: linear-gradient(135deg, #fff740, #ffed4a); }
        .note-pink { background: linear-gradient(135deg, #ff7eb9, #ff65a3); }
        .note-blue { background: linear-gradient(135deg, #7cb9ff, #60a5fa); }
        .note-green { background: linear-gradient(135deg, #7eff7e, #4ade80); }
        .note-orange { background: linear-gradient(135deg, #ffb347, #fb923c); }
        .note-purple { background: linear-gradient(135deg, #b19cd9, #a78bfa); }

        .instructions {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 320px;
            z-index: 1000;
        }

        .instructions h3 {
            margin-bottom: 8px;
            color: #4CAF50;
        }

        .instructions ul {
            list-style: none;
        }

        .instructions li {
            margin-bottom: 5px;
            padding-left: 12px;
            position: relative;
        }

        .instructions li::before {
            content: '•';
            position: absolute;
            left: 0;
            color: #4CAF50;
        }

        /* Screenshot flash effect */
        .screenshot-flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 10000;
            animation: flash 0.2s ease-in-out;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        .screenshot-status {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(76, 175, 80, 0.95);
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            z-index: 10001;
            display: none;
            align-items: center;
            gap: 10px;
        }

        .screenshot-status.show {
            display: flex;
            animation: slideInScale 0.3s ease;
        }

        @keyframes slideInScale {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .save-status {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 14px;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 8px;
        }

        .save-status.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        .save-status.error {
            background: rgba(244, 67, 54, 0.9);
        }

        .export-section {
            border-top: 1px solid #ddd;
            padding-top: 15px;
            margin-top: 15px;
        }

        .export-section h4 {
            margin-bottom: 10px;
            color: #666;
            font-size: 14px;
        }

        .export-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .export-btn {
            background: linear-gradient(135deg, #FF5722, #D84315);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            background: linear-gradient(135deg, #607D8B, #455A64);
            color: white;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="controls">
        <button class="control-btn" onclick="addNewNote()">📝 Add Note</button>
        <button class="control-btn clear-btn" onclick="clearAllNotes()">🗑️ Clear All</button>
        <button class="control-btn bg-btn" onclick="toggleBgSettings()">🎨 Background</button>
        <button class="control-btn font-btn" onclick="toggleFontSettings()">📝 Fonts</button>
        <button class="control-btn save-btn" onclick="saveToFile()">💾 Save</button>
        <button class="control-btn load-btn" onclick="document.getElementById('fileInput').click()">📂 Load</button>
        <button class="control-btn screenshot-btn" onclick="takeScreenshot()">📷 Screenshot</button>
    </div>

    <div class="bg-settings" id="bgSettings">
        <button class="close-settings" onclick="toggleBgSettings()">&times;</button>
        <h3>🎨 Background Themes</h3>
        <div class="bg-options">
            <div class="bg-option active" data-bg="cork" style="background: linear-gradient(135deg, #f5f1e8 0%, #e8dcc0 50%, #d4c4a0 100%);"></div>
            <div class="bg-option" data-bg="wood" style="background: linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%);"></div>
            <div class="bg-option" data-bg="slate" style="background: linear-gradient(135deg, #2F4F4F 0%, #708090 50%, #A9A9A9 100%);"></div>
            <div class="bg-option" data-bg="mint" style="background: linear-gradient(135deg, #E8F5E8 0%, #D4F4DD 50%, #C8E6C9 100%);"></div>
            <div class="bg-option" data-bg="ocean" style="background: linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%);"></div>
            <div class="bg-option" data-bg="sunset" style="background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%);"></div>
            <div class="bg-option" data-bg="lavender" style="background: linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%);"></div>
            <div class="bg-option" data-bg="rose" style="background: linear-gradient(135deg, #FCE4EC 0%, #F8BBD9 50%, #F48FB1 100%);"></div>
            <div class="bg-option" data-bg="dark" style="background: linear-gradient(135deg, #37474F 0%, #546E7A 50%, #78909C 100%);"></div>
        </div>
        
        <div class="custom-color-section">
            <h4>🌈 Custom Color</h4>
            <div class="color-picker-container">
                <input type="color" class="color-picker" id="customColor" value="#f5f1e8">
                <button class="apply-custom-btn" onclick="applyCustomColor()">Apply</button>
            </div>
        </div>

        <div class="export-section">
            <h4>📤 Export for Notion</h4>
            <div class="export-buttons">
                <button class="export-btn" onclick="exportForNotion()">Export JSON</button>
                <button class="export-btn" onclick="copyNotionCode()">Copy HTML</button>
            </div>
        </div>
    </div>

    <div class="font-settings" id="fontSettings">
        <button class="close-settings" onclick="toggleFontSettings()">&times;</button>
        <h3>📝 Font Settings</h3>
        
        <div class="font-controls">
            <div class="font-control-group">
                <label for="fontFamily">Font Family:</label>
                <select class="font-family-select" id="fontFamily" onchange="applyFontSettings()">
                    <option value="Comic Neue">Comic Neue</option>
                    <option value="Caveat">Caveat</option>
                    <option value="Kalam">Kalam</option>
                    <option value="Patrick Hand">Patrick Hand</option>
                    <option value="Architects Daughter">Architects Daughter</option>
                    <option value="Indie Flower">Indie Flower</option>
                    <option value="Dancing Script">Dancing Script</option>
                    <option value="Permanent Marker">Permanent Marker</option>
                    <option value="Amatic SC">Amatic SC</option>
                    <option value="Shadows Into Light">Shadows Into Light</option>
                </select>
            </div>
            
            <div class="font-control-group">
                <label for="fontSize">Font Size:</label>
                <div class="font-size-control">
                    <input type="range" class="font-size-slider" id="fontSize" 
                           min="10" max="24" value="14" onchange="applyFontSettings()">
                    <span class="font-size-display" id="fontSizeDisplay">14px</span>
                </div>
            </div>
            
            <button class="apply-font-btn" onclick="applyFontToAllNotes()">Apply to All Notes</button>
        </div>
    </div>

    <input type="file" id="fileInput" class="file-input" accept=".json" onchange="loadFromFile(event)">

    <div class="instructions">
        <h3>🌟 Notion Integration Ready:</h3>
        <ul>
            <li>📝 Create and customize sticky notes</li>
            <li>💾 Save your work as JSON files</li>
            <li>📤 Export for Notion embedding</li>
            <li>🎨 Customize backgrounds and fonts</li>
            <li>📂 Load saved note configurations</li>
            <li>📷 Take screenshots for sharing</li>
            <li>🔗 Use GitHub Pages for live sharing</li>
        </ul>
    </div>

    <div class="save-status" id="saveStatus">
        💾 Notes saved successfully!
    </div>

    <div class="screenshot-flash" id="screenshotFlash"></div>
    <div class="screenshot-status" id="screenshotStatus">
        📷 Screenshot saved!
    </div>

    <script>
        let noteId = 0;
        let draggedNote = null;
        let offset = { x: 0, y: 0 };
        let notes = [];
        let currentFontFamily = 'Comic Neue';
        let currentFontSize = 14;

        const colors = ['note-yellow', 'note-pink', 'note-blue', 'note-green', 'note-orange', 'note-purple'];

        const backgrounds = {
            cork: 'linear-gradient(135deg, #f5f1e8 0%, #e8dcc0 50%, #d4c4a0 100%)',
            wood: 'linear-gradient(135deg, #8B4513 0%, #A0522D 50%, #CD853F 100%)',
            slate: 'linear-gradient(135deg, #2F4F4F 0%, #708090 50%, #A9A9A9 100%)',
            mint: 'linear-gradient(135deg, #E8F5E8 0%, #D4F4DD 50%, #C8E6C9 100%)',
            ocean: 'linear-gradient(135deg, #E3F2FD 0%, #BBDEFB 50%, #90CAF9 100%)',
            sunset: 'linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 50%, #FFCC80 100%)',
            lavender: 'linear-gradient(135deg, #F3E5F5 0%, #E1BEE7 50%, #CE93D8 100%)',
            rose: 'linear-gradient(135deg, #FCE4EC 0%, #F8BBD9 50%, #F48FB1 100%)',
            dark: 'linear-gradient(135deg, #37474F 0%, #546E7A 50%, #78909C 100%)'
        };

        // Initialize with sample notes
        window.addEventListener('load', () => {
            addNewNote(300, 200, "Welcome to Sticky Notes!\nPerfect for Notion integration! 🌟", 'note-yellow');
            addNewNote(600, 300, "💾 Save & Load your notes\n📤 Export for Notion\n🎨 Customize everything!", 'note-blue');
            addNewNote(200, 450, "Click inside to\nedit my text ✏️", 'note-pink');
            
            // Add background option click handlers
            document.querySelectorAll('.bg-option').forEach(option => {
                option.addEventListener('click', () => changeBg(option.dataset.bg));
            });
            
            // Load saved state if available
            loadFromStorage();
            
            // Initialize font size display
            updateFontSizeDisplay();

            // Auto-save periodically
            setInterval(saveToStorage, 30000); // Auto-save every 30 seconds
        });

        function addNewNote(x = null, y = null, text = "New note...", colorClass = null) {
            noteId++;
            
            const note = document.createElement('div');
            const noteColorClass = colorClass || colors[Math.floor(Math.random() * colors.length)];
            note.className = `sticky-note ${noteColorClass}`;
            note.dataset.id = noteId;
            note.style.left = (x || Math.random() * (window.innerWidth - 220) + 20) + 'px';
            note.style.top = (y || Math.random() * (window.innerHeight - 220) + 60) + 'px';
            note.style.zIndex = noteId;
            note.style.setProperty('--note-font-family', currentFontFamily);
            note.style.setProperty('--note-font-size', currentFontSize + 'px');
            
            const rotation = (Math.random() - 0.5) * 30;
            note.style.transform = `rotate(${rotation}deg)`;
            
            note.innerHTML = `
                <button class="delete-btn" onclick="deleteNote(this)">&times;</button>
                <textarea placeholder="Type your note here..." oninput="autoSave()">${text}</textarea>
            `;

            document.body.appendChild(note);
            notes.push(note);

            note.addEventListener('mousedown', startDrag);
            
            if (text === "New note...") {
                setTimeout(() => {
                    const textarea = note.querySelector('textarea');
                    textarea.focus();
                    textarea.select();
                }, 100);
            }

            saveToStorage();
            return note;
        }

        function toggleBgSettings() {
            const bgSettings = document.getElementById('bgSettings');
            const fontSettings = document.getElementById('fontSettings');
            fontSettings.classList.remove('show');
            bgSettings.classList.toggle('show');
        }

        function toggleFontSettings() {
            const fontSettings = document.getElementById('fontSettings');
            const bgSettings = document.getElementById('bgSettings');
            bgSettings.classList.remove('show');
            fontSettings.classList.toggle('show');
        }

        function changeBg(bgType) {
            applyBackground(backgrounds[bgType], bgType);
            setTimeout(() => toggleBgSettings(), 300);
            saveToStorage();
        }

        function applyBackground(gradient, type) {
            document.documentElement.style.setProperty('--bg-gradient', gradient);
            
            // Update active state
            document.querySelectorAll('.bg-option').forEach(opt => opt.classList.remove('active'));
            if (type) {
                const activeOption = document.querySelector(`[data-bg="${type}"]`);
                if (activeOption) activeOption.classList.add('active');
            }
        }

        function applyCustomColor() {
            const color = document.getElementById('customColor').value;
            const lightColor = adjustBrightness(color, 20);
            const darkColor = adjustBrightness(color, -20);
            
            const customGradient = `linear-gradient(135deg, ${lightColor} 0%, ${color} 50%, ${darkColor} 100%)`;
            applyBackground(customGradient);
            
            setTimeout(() => toggleBgSettings(), 300);
            saveToStorage();
        }

        function applyFontSettings() {
            const fontFamily = document.getElementById('fontFamily').value;
            const fontSize = parseInt(document.getElementById('fontSize').value);
            
            currentFontFamily = fontFamily;
            currentFontSize = fontSize;
            
            updateFontSizeDisplay();
            saveToStorage();
        }

        function updateFontSizeDisplay() {
            const fontSizeDisplay = document.getElementById('fontSizeDisplay');
            fontSizeDisplay.textContent = currentFontSize + 'px';
        }

        function applyFontToAllNotes() {
            notes.forEach(note => {
                note.style.setProperty('--note-font-family', currentFontFamily);
                note.style.setProperty('--note-font-size', currentFontSize + 'px');
            });
            
            setTimeout(() => toggleFontSettings(), 300);
            saveToStorage();
        }

        function adjustBrightness(hex, percent) {
            const num = parseInt(hex.replace("#", ""), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) + amt;
            const G = (num >> 8 & 0x00FF) + amt;
            const B = (num & 0x0000FF) + amt;
            return "#" + (0x1000000 + (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)).toString(16).slice(1);
        }

        function autoSave() {
            clearTimeout(window.autoSaveTimer);
            window.autoSaveTimer = setTimeout(saveToStorage, 2000);
        }

        function saveToStorage() {
            try {
                const notesData = notes.map(note => ({
                    id: parseInt(note.dataset.id),
                    x: parseFloat(note.style.left),
                    y: parseFloat(note.style.top),
                    rotation: parseFloat(note.style.transform.replace('rotate(', '').replace('deg)', '') || 0),
                    color: note.className.split(' ').find(cls => cls.startsWith('note-')),
                    text: note.querySelector('textarea').value,
                    zIndex: note.style.zIndex,
                    fontFamily: note.style.getPropertyValue('--note-font-family') || 'Comic Neue',
                    fontSize: parseInt(note.style.getPropertyValue('--note-font-size')) || 14
                }));

                const saveData = {
                    notes: notesData,
                    background: document.documentElement.style.getPropertyValue('--bg-gradient'),
                    globalFontFamily: currentFontFamily,
                    globalFontSize: currentFontSize,
                    timestamp: new Date().toISOString()
                };

                localStorage.setItem('stickyNotesData', JSON.stringify(saveData));
            } catch (error) {
                console.error('Error saving to storage:', error);
            }
        }

        function loadFromStorage() {
            try {
                const savedData = localStorage.getItem('stickyNotesData');
                if (savedData) {
                    const data = JSON.parse(savedData);
                    
                    // Clear existing notes
                    notes.forEach(note => note.remove());
                    notes = [];
                    
                    // Load background
                    if (data.background) {
                        document.documentElement.style.setProperty('--bg-gradient', data.background);
                    }
                    
                    // Load global font settings
                    if (data.globalFontFamily) {
                        currentFontFamily = data.globalFontFamily;
                        document.getElementById('fontFamily').value = currentFontFamily;
                    }
                    
                    if (data.globalFontSize) {
                        currentFontSize = data.globalFontSize;
                        document.getElementById('fontSize').value = currentFontSize;
                        updateFontSizeDisplay();
                    }
                    
                    // Load notes
                    if (data.notes && data.notes.length > 0) {
                        data.notes.forEach(noteData => {
                            const note = document.createElement('div');
                            note.className = `sticky-note ${noteData.color}`;
                            note.dataset.id = noteData.id;
                            note.style.left = noteData.x + 'px';
                            note.style.top = noteData.y + 'px';
                            note.style.zIndex = noteData.zIndex;
                            note.style.transform = `rotate(${noteData.rotation}deg)`;
                            note.style.setProperty('--note-font-family', noteData.fontFamily || 'Comic Neue');
                            note.style.setProperty('--note-font-size', (noteData.fontSize || 14) + 'px');
                            
                            note.innerHTML = `
                                <button class="delete-btn" onclick="deleteNote(this)">&times;</button>
                                <textarea placeholder="Type your note here..." oninput="autoSave()">${noteData.text}</textarea>
                            `;

                            document.body.appendChild(note);
                            notes.push(note);
                            note.addEventListener('mousedown', startDrag);
                            
                            noteId = Math.max(noteId, noteData.id);
                        });
                    }
                }
            } catch (error) {
                console.error('Error loading from storage:', error);
            }
        }

        function saveToFile() {
            try {
                const notesData = notes.map(note => ({
                    id: parseInt(note.dataset.id),
                    x: parseFloat(note.style.left),
                    y: parseFloat(note.style.top),
                    rotation: parseFloat(note.style.transform.replace('rotate(', '').replace('deg)', '') || 0),
                    color: note.className.split(' ').find(cls => cls.startsWith('note-')),
                    text: note.querySelector('textarea').value,
                    zIndex: note.style.zIndex,
                    fontFamily: note.style.getPropertyValue('--note-font-family') || 'Comic Neue',
                    fontSize: parseInt(note.style.getPropertyValue('--note-font-size')) || 14
                }));

                const saveData = {
                    notes: notesData,
                    background: document.documentElement.style.getPropertyValue('--bg-gradient'),
                    globalFontFamily: currentFontFamily,
                    globalFontSize: currentFontSize,
                    timestamp: new Date().toISOString(),
                    version: '1.0'
                };

                const blob = new Blob([JSON.stringify(saveData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `sticky-notes-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showSaveStatus('💾 Notes saved to file!');
            } catch (error) {
                console.error('Error saving to file:', error);
                showSaveStatus('❌ Error saving file', true);
            }
        }

        function loadFromFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Clear existing notes
                    notes.forEach(note => note.remove());
                    notes = [];
                    
                    // Load background
                    if (data.background) {
                        document.documentElement.style.setProperty('--bg-gradient', data.background);
                    }
                    
                    // Load global font settings
                    if (data.globalFontFamily) {
                        currentFontFamily = data.globalFontFamily;
                        document.getElementById('fontFamily').value = currentFontFamily;
                    }
                    
                    if (data.globalFontSize) {
                        currentFontSize = data.globalFontSize;
                        document.getElementById('fontSize').value = currentFontSize;
                        updateFontSizeDisplay();
                    }
                    
                    // Load notes
                    if (data.notes && data.notes.length > 0) {
                        data.notes.forEach(noteData => {
                            const note = document.createElement('div');
                            note.className = `sticky-note ${noteData.color}`;
                            note.dataset.id = noteData.id;
                            note.style.left = noteData.x + 'px';
                            note.style.top = noteData.y + 'px';
                            note.style.zIndex = noteData.zIndex;
                            note.style.transform = `rotate(${noteData.rotation}deg)`;
                            note.style.setProperty('--note-font-family', noteData.fontFamily || 'Comic Neue');
                            note.style.setProperty('--note-font-size', (noteData.fontSize || 14) + 'px');
                            
                            note.innerHTML = `
                                <button class="delete-btn" onclick="deleteNote(this)">&times;</button>
                                <textarea placeholder="Type your note here..." oninput="autoSave()">${noteData.text}</textarea>
                            `;

                            document.body.appendChild(note);
                            notes.push(note);
                            note.addEventListener('mousedown', startDrag);
                            
                            noteId = Math.max(noteId, noteData.id);
                        });
                    }

                    showSaveStatus('📂 Notes loaded successfully!');
                    saveToStorage(); // Save to localStorage as well
                } catch (error) {
                    console.error('Error loading file:', error);
                    showSaveStatus('❌ Error loading file', true);
                }
            };
            
            reader.readAsText(file);
            event.target.value = ''; // Clear file input
        }

        function exportForNotion() {
            try {
                const notesData = notes.map(note => ({
                    id: parseInt(note.dataset.id),
                    text: note.querySelector('textarea').value,
                    color: note.className.split(' ').find(cls => cls.startsWith('note-')),
                    fontFamily: note.style.getPropertyValue('--note-font-family') || 'Comic Neue',
                    fontSize: parseInt(note.style.getPropertyValue('--note-font-size')) || 14
                }));

                const notionData = {
                    title: 'Sticky Notes Export',
                    created: new Date().toISOString(),
                    notes: notesData,
                    settings: {
                        background: document.documentElement.style.getPropertyValue('--bg-gradient'),
                        globalFontFamily: currentFontFamily,
                        globalFontSize: currentFontSize
                    }
                };

                const blob = new Blob([JSON.stringify(notionData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `notion-sticky-notes-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);

                showSaveStatus('📤 Exported for Notion!');
            } catch (error) {
                console.error('Error exporting for Notion:', error);
                showSaveStatus('❌ Export failed', true);
            }
        }

        function copyNotionCode() {
            const htmlCode = document.documentElement.outerHTML;
            
            navigator.clipboard.writeText(htmlCode).then(() => {
                showSaveStatus('📋 HTML copied to clipboard!');
            }).catch(err => {
                console.error('Could not copy text: ', err);
                showSaveStatus('❌ Copy failed', true);
            });
        }

        function showSaveStatus(message, isError = false) {
            const status = document.getElementById('saveStatus');
            status.textContent = message;
            status.classList.toggle('error', isError);
            status.classList.add('show');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 3000);
        }

        async function takeScreenshot() {
            const controls = document.querySelector('.controls');
            const instructions = document.querySelector('.instructions');
            const bgSettings = document.getElementById('bgSettings');
            const fontSettings = document.getElementById('fontSettings');
            const saveStatus = document.getElementById('saveStatus');
            
            controls.style.display = 'none';
            instructions.style.display = 'none';
            bgSettings.style.display = 'none';
            fontSettings.style.display = 'none';
            saveStatus.style.display = 'none';
            
            const flash = document.getElementById('screenshotFlash');
            flash.style.display = 'block';
            flash.style.animation = 'flash 0.2s ease-in-out';
            
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                
                const currentBg = document.documentElement.style.getPropertyValue('--bg-gradient');
                const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                
                if (currentBg.includes('cork') || !currentBg) {
                    gradient.addColorStop(0, '#f5f1e8');
                    gradient.addColorStop(0.5, '#e8dcc0');
                    gradient.addColorStop(1, '#d4c4a0');
                } else {
                    gradient.addColorStop(0, '#f5f5f5');
                    gradient.addColorStop(1, '#e0e0e0');
                }
                
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Use your browser\'s screenshot tool or right-click to "Save As"', canvas.width / 2, 50);
                
                const link = document.createElement('a');
                link.href = canvas.toDataURL('image/png');
                link.download = 'sticky-notes-wall.png';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                showScreenshotStatus();
            } catch (error) {
                console.error('Screenshot failed:', error);
                alert('Use your browser\'s built-in screenshot tool or right-click to "Save As"!');
            }
            
            setTimeout(() => {
                controls.style.display = 'flex';
                instructions.style.display = 'block';
                flash.style.display = 'none';
            }, 300);
        }

        function showScreenshotStatus() {
            const status = document.getElementById('screenshotStatus');
            status.classList.add('show');
            
            setTimeout(() => {
                status.classList.remove('show');
            }, 2000);
        }

        function startDrag(e) {
            if (e.target.tagName === 'TEXTAREA' || e.target.classList.contains('delete-btn')) {
                return;
            }

            draggedNote = e.currentTarget;
            draggedNote.classList.add('dragging');
            draggedNote.style.zIndex = ++noteId;
            
            const rect = draggedNote.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;

            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', stopDrag);
            
            e.preventDefault();
        }

        function drag(e) {
            if (!draggedNote) return;
            
            const x = e.clientX - offset.x;
            const y = e.clientY - offset.y;
            
            const maxX = window.innerWidth - 200;
            const maxY = window.innerHeight - 200;
            
            draggedNote.style.left = Math.max(0, Math.min(x, maxX)) + 'px';
            draggedNote.style.top = Math.max(0, Math.min(y, maxY)) + 'px';
        }

        function stopDrag(e) {
            if (!draggedNote) return;
            
            draggedNote.classList.remove('dragging');
            
            const currentRotation = parseFloat(draggedNote.style.transform.replace('rotate(', '').replace('deg)', '') || 0);
            const newRotation = currentRotation + (Math.random() - 0.5) * 10;
            draggedNote.style.transform = `rotate(${Math.max(-20, Math.min(20, newRotation))}deg)`;
            
            draggedNote = null;
            
            document.removeEventListener('mousemove', drag);
            document.removeEventListener('mouseup', stopDrag);
            
            autoSave();
        }

        function deleteNote(button) {
            const note = button.parentElement;
            const index = notes.indexOf(note);
            
            if (index > -1) {
                notes.splice(index, 1);
            }
            
            note.remove();
            saveToStorage();
        }

        function clearAllNotes() {
            if (confirm('Are you sure you want to delete all notes?')) {
                notes.forEach(note => note.remove());
                notes = [];
                saveToStorage();
            }
        }

        // Close settings when clicking outside
        document.addEventListener('click', (e) => {
            const bgSettings = document.getElementById('bgSettings');
            const fontSettings = document.getElementById('fontSettings');
            const bgBtn = document.querySelector('.bg-btn');
            const fontBtn = document.querySelector('.font-btn');
            
            if (!bgSettings.contains(e.target) && !bgBtn.contains(e.target) && bgSettings.classList.contains('show')) {
                bgSettings.classList.remove('show');
            }
            
            if (!fontSettings.contains(e.target) && !fontBtn.contains(e.target) && fontSettings.classList.contains('show')) {
                fontSettings.classList.remove('show');
            }
        });

        // Prevent text selection while dragging
        document.addEventListener('selectstart', (e) => {
            if (draggedNote) {
                e.preventDefault();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                addNewNote();
            }
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                saveToFile();
            }
            if (e.key === 'Escape') {
                const bgSettings = document.getElementById('bgSettings');
                const fontSettings = document.getElementById('fontSettings');
                if (bgSettings.classList.contains('show')) {
                    bgSettings.classList.remove('show');
                }
                if (fontSettings.classList.contains('show')) {
                    fontSettings.classList.remove('show');
                }
            }
        });

        // Update font size display when slider moves
        document.getElementById('fontSize').addEventListener('input', (e) => {
            currentFontSize = parseInt(e.target.value);
            updateFontSizeDisplay();
        });

        // Update font family when selection changes
        document.getElementById('fontFamily').addEventListener('change', (e) => {
            currentFontFamily = e.target.value;
        });

        // Auto-save on page unload
        window.addEventListener('beforeunload', () => {
            saveToStorage();
        });
    </script>
</body>
</html>